;; gorilla-repl.fileformat = 1

;; **
;;; # CIM Portfolio
;; **

;; **
;;; ### Required packages
;; **

;; @@
(ns cim_portfolio.portfolio
  (:require [clojure.data.csv :as csv]
            [clj-http.client :as http]
            [cheshire.core :as json]
            [clj-time.core :as t]
            [clj-time.format :as tf]
            [clojure.string :as str]
            [java-time :as jt]
            [cim_portfolio.server :as server]
            ))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; ### Helper Functions
;; **

;; @@
;; FOR DATE PROCESSING
(def multi-parser (tf/formatter (t/default-time-zone) "YYYY-MM-dd" "YYYY/MM/dd" "YYYYMMdd"))

(defn parse-date [date]
  (tf/unparse multi-parser (tf/parse multi-parser date)))

(defn read-csv [file]
  (with-open [reader (clojure.java.io/reader file)]
    (doall (csv/read-csv reader))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;cim_portfolio.portfolio/read-csv</span>","value":"#'cim_portfolio.portfolio/read-csv"}
;; <=

;; @@
(parse-date "2023/12/25")
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;2023-12-25&quot;</span>","value":"\"2023-12-25\""}
;; <=

;; @@
;; HELPER FUNCTIONS FOR ORDERING A MAP BY THE DATE
(defn jt-parse-date [date-str]
  (jt/local-date "yyyy-MM-dd" date-str))

(defn jt-compare-dates [date-str1 date-str2]
  (let [date1 (jt-parse-date date-str1)
        date2 (jt-parse-date date-str2)]
    (jt/before? date1 date2)))

(defn sort-map-by-date [map]
  (into (sorted-map-by jt-compare-dates) map))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;cim_portfolio.portfolio/sort-map-by-date</span>","value":"#'cim_portfolio.portfolio/sort-map-by-date"}
;; <=

;; @@
;; Helper functions for computing cumulative returns
(defn sum-up-to-key [key data]
  (
   + (get data key 0)		;; Adds data entry of key itself as well
     (->> (keys data)	;; calculates the sum of entries till key
       (take-while #(not= % key))
       (map #(get data %))
       (apply +))
   )
  
)


(sum-up-to-key "c" {"a" 1 "b" 2 "c" 3 "d" 4 "e" 5}) ; Output: 6
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-long'>6</span>","value":"6"}
;; <=

;; @@
;; Computes arithmetic, log, and cumulative return for a given list of prices
(defn calculate-returns [prices]
  (let [price-changes (map #(double (/ (second %) (first %))) (partition 2 1 prices))
        arithmetic-returns (mapv #(- % 1.0) price-changes)
        log-returns (mapv #(Math/log %) price-changes)
        cumulative-log-return (reduce + log-returns)]
    {
     :cumulative-return cumulative-log-return
     :arithmetic-returns arithmetic-returns
     :log-returns log-returns
     }))

;; Similar to function above - associates the returns with their corresponding date
(defn calculate-returns-with-corresponding-date [prices dates]
  (let [price-changes (map #(double (/ (second %) (first %))) (partition 2 1 prices))
        arithmetic-returns (mapv #(- % 1.0) price-changes)
        log-returns (mapv #(Math/log %) price-changes)
        cumulative-log-return (reduce + log-returns)]
    {
     :cumulative-return cumulative-log-return
     :arithmetic-returns (sort-map-by-date (zipmap (rest dates) arithmetic-returns))
     :log-returns (sort-map-by-date (zipmap (rest dates) log-returns))
     }))

;; Calculates portfolio return - accepts map {:stock cash-invested} and stock-performance generated by calculate-returns
(defn calculate-portfolio-return [cash-invested returns]
  (let [total-investment (apply + (vals cash-invested))]
    (->> cash-invested
         (map (fn [[security invested]]
                (let [weight (/ invested total-investment)
                      return (:cumulative-return (get returns security))]
                  (* weight return))))
         (apply +))))

;; Calculates cumulative return UP TILL a given date
(defn get-cumulative-return-till-given-date [cumulative-returns date]
  (sum-up-to-key date cumulative-returns)
)

;; Only calculates portfolio return up till a given date
(defn calculate-portfolio-return-for-given-date [cash-invested returns date]
  ;(println "------")
  ;(println "Calculating returns on: " date)
  ;(println cash-invested)
  ;(println "------")
  (let [total-investment (apply + (vals cash-invested))]
    (->> cash-invested
         (map (fn [[security invested]]
                (let [weight (/ invested total-investment)
                      return (get-cumulative-return-till-given-date (:log-returns (get returns security)) date)
                     ]
                  (* weight return))))
         (apply +))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;cim_portfolio.portfolio/calculate-portfolio-return-for-given-date</span>","value":"#'cim_portfolio.portfolio/calculate-portfolio-return-for-given-date"}
;; <=

;; @@
(calculate-returns [100 110 120 130])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:cumulative-return</span>","value":":cumulative-return"},{"type":"html","content":"<span class='clj-double'>0.262364264467491</span>","value":"0.262364264467491"}],"value":"[:cumulative-return 0.262364264467491]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:arithmetic-returns</span>","value":":arithmetic-returns"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.10000000000000009</span>","value":"0.10000000000000009"},{"type":"html","content":"<span class='clj-double'>0.09090909090909105</span>","value":"0.09090909090909105"},{"type":"html","content":"<span class='clj-double'>0.08333333333333304</span>","value":"0.08333333333333304"}],"value":"[0.10000000000000009 0.09090909090909105 0.08333333333333304]"}],"value":"[:arithmetic-returns [0.10000000000000009 0.09090909090909105 0.08333333333333304]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:log-returns</span>","value":":log-returns"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.09531017980432493</span>","value":"0.09531017980432493"},{"type":"html","content":"<span class='clj-double'>0.0870113769896299</span>","value":"0.0870113769896299"},{"type":"html","content":"<span class='clj-double'>0.08004270767353615</span>","value":"0.08004270767353615"}],"value":"[0.09531017980432493 0.0870113769896299 0.08004270767353615]"}],"value":"[:log-returns [0.09531017980432493 0.0870113769896299 0.08004270767353615]]"}],"value":"{:cumulative-return 0.262364264467491, :arithmetic-returns [0.10000000000000009 0.09090909090909105 0.08333333333333304], :log-returns [0.09531017980432493 0.0870113769896299 0.08004270767353615]}"}
;; <=

;; **
;;; ### YFinance API
;; **

;; @@
(server/get-ticker-price-all "AAPL" "2023-12-25")
;; @@
;; ->
;;; [*********************100%%**********************]  1 of 1 completed
;;; 
;; <-
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2023-12-26&quot;</span>","value":"\"2023-12-26\""},{"type":"html","content":"<span class='clj-double'>193.6100006104</span>","value":"193.6100006104"},{"type":"html","content":"<span class='clj-double'>192.8039855957</span>","value":"192.8039855957"}],"value":"[\"2023-12-26\" 193.6100006104 192.8039855957]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2023-12-27&quot;</span>","value":"\"2023-12-27\""},{"type":"html","content":"<span class='clj-double'>192.4900054932</span>","value":"192.4900054932"},{"type":"html","content":"<span class='clj-double'>192.9038391113</span>","value":"192.9038391113"}],"value":"[\"2023-12-27\" 192.4900054932 192.9038391113]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2023-12-28&quot;</span>","value":"\"2023-12-28\""},{"type":"html","content":"<span class='clj-double'>194.1399993896</span>","value":"194.1399993896"},{"type":"html","content":"<span class='clj-double'>193.3332977295</span>","value":"193.3332977295"}],"value":"[\"2023-12-28\" 194.1399993896 193.3332977295]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2023-12-29&quot;</span>","value":"\"2023-12-29\""},{"type":"html","content":"<span class='clj-double'>193.8999938965</span>","value":"193.8999938965"},{"type":"html","content":"<span class='clj-double'>192.2846374512</span>","value":"192.2846374512"}],"value":"[\"2023-12-29\" 193.8999938965 192.2846374512]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-02&quot;</span>","value":"\"2024-01-02\""},{"type":"html","content":"<span class='clj-double'>187.1499938965</span>","value":"187.1499938965"},{"type":"html","content":"<span class='clj-double'>185.4034118652</span>","value":"185.4034118652"}],"value":"[\"2024-01-02\" 187.1499938965 185.4034118652]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-03&quot;</span>","value":"\"2024-01-03\""},{"type":"html","content":"<span class='clj-double'>184.2200012207</span>","value":"184.2200012207"},{"type":"html","content":"<span class='clj-double'>184.0151977539</span>","value":"184.0151977539"}],"value":"[\"2024-01-03\" 184.2200012207 184.0151977539]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-04&quot;</span>","value":"\"2024-01-04\""},{"type":"html","content":"<span class='clj-double'>182.1499938965</span>","value":"182.1499938965"},{"type":"html","content":"<span class='clj-double'>181.6781768799</span>","value":"181.6781768799"}],"value":"[\"2024-01-04\" 182.1499938965 181.6781768799]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-05&quot;</span>","value":"\"2024-01-05\""},{"type":"html","content":"<span class='clj-double'>181.9900054932</span>","value":"181.9900054932"},{"type":"html","content":"<span class='clj-double'>180.9490966797</span>","value":"180.9490966797"}],"value":"[\"2024-01-05\" 181.9900054932 180.9490966797]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-08&quot;</span>","value":"\"2024-01-08\""},{"type":"html","content":"<span class='clj-double'>182.0899963379</span>","value":"182.0899963379"},{"type":"html","content":"<span class='clj-double'>185.3235168457</span>","value":"185.3235168457"}],"value":"[\"2024-01-08\" 182.0899963379 185.3235168457]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-09&quot;</span>","value":"\"2024-01-09\""},{"type":"html","content":"<span class='clj-double'>183.9199981689</span>","value":"183.9199981689"},{"type":"html","content":"<span class='clj-double'>184.9040527344</span>","value":"184.9040527344"}],"value":"[\"2024-01-09\" 183.9199981689 184.9040527344]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-10&quot;</span>","value":"\"2024-01-10\""},{"type":"html","content":"<span class='clj-double'>184.3500061035</span>","value":"184.3500061035"},{"type":"html","content":"<span class='clj-double'>185.9527130127</span>","value":"185.9527130127"}],"value":"[\"2024-01-10\" 184.3500061035 185.9527130127]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-11&quot;</span>","value":"\"2024-01-11\""},{"type":"html","content":"<span class='clj-double'>186.5399932861</span>","value":"186.5399932861"},{"type":"html","content":"<span class='clj-double'>185.3534851074</span>","value":"185.3534851074"}],"value":"[\"2024-01-11\" 186.5399932861 185.3534851074]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-12&quot;</span>","value":"\"2024-01-12\""},{"type":"html","content":"<span class='clj-double'>186.0599975586</span>","value":"186.0599975586"},{"type":"html","content":"<span class='clj-double'>185.6830596924</span>","value":"185.6830596924"}],"value":"[\"2024-01-12\" 186.0599975586 185.6830596924]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-16&quot;</span>","value":"\"2024-01-16\""},{"type":"html","content":"<span class='clj-double'>182.1600036621</span>","value":"182.1600036621"},{"type":"html","content":"<span class='clj-double'>183.395980835</span>","value":"183.395980835"}],"value":"[\"2024-01-16\" 182.1600036621 183.395980835]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-17&quot;</span>","value":"\"2024-01-17\""},{"type":"html","content":"<span class='clj-double'>181.2700042725</span>","value":"181.2700042725"},{"type":"html","content":"<span class='clj-double'>182.4471893311</span>","value":"182.4471893311"}],"value":"[\"2024-01-17\" 181.2700042725 182.4471893311]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-18&quot;</span>","value":"\"2024-01-18\""},{"type":"html","content":"<span class='clj-double'>186.0899963379</span>","value":"186.0899963379"},{"type":"html","content":"<span class='clj-double'>188.3896179199</span>","value":"188.3896179199"}],"value":"[\"2024-01-18\" 186.0899963379 188.3896179199]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-19&quot;</span>","value":"\"2024-01-19\""},{"type":"html","content":"<span class='clj-double'>189.3300018311</span>","value":"189.3300018311"},{"type":"html","content":"<span class='clj-double'>191.3158721924</span>","value":"191.3158721924"}],"value":"[\"2024-01-19\" 189.3300018311 191.3158721924]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-22&quot;</span>","value":"\"2024-01-22\""},{"type":"html","content":"<span class='clj-double'>192.3000030518</span>","value":"192.3000030518"},{"type":"html","content":"<span class='clj-double'>193.6428985596</span>","value":"193.6428985596"}],"value":"[\"2024-01-22\" 192.3000030518 193.6428985596]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-23&quot;</span>","value":"\"2024-01-23\""},{"type":"html","content":"<span class='clj-double'>195.0200042725</span>","value":"195.0200042725"},{"type":"html","content":"<span class='clj-double'>194.9312591553</span>","value":"194.9312591553"}],"value":"[\"2024-01-23\" 195.0200042725 194.9312591553]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-24&quot;</span>","value":"\"2024-01-24\""},{"type":"html","content":"<span class='clj-double'>195.4199981689</span>","value":"195.4199981689"},{"type":"html","content":"<span class='clj-double'>194.2521209717</span>","value":"194.2521209717"}],"value":"[\"2024-01-24\" 195.4199981689 194.2521209717]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-25&quot;</span>","value":"\"2024-01-25\""},{"type":"html","content":"<span class='clj-double'>195.2200012207</span>","value":"195.2200012207"},{"type":"html","content":"<span class='clj-double'>193.9225463867</span>","value":"193.9225463867"}],"value":"[\"2024-01-25\" 195.2200012207 193.9225463867]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-26&quot;</span>","value":"\"2024-01-26\""},{"type":"html","content":"<span class='clj-double'>194.2700042725</span>","value":"194.2700042725"},{"type":"html","content":"<span class='clj-double'>192.1747741699</span>","value":"192.1747741699"}],"value":"[\"2024-01-26\" 194.2700042725 192.1747741699]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-29&quot;</span>","value":"\"2024-01-29\""},{"type":"html","content":"<span class='clj-double'>192.0099945068</span>","value":"192.0099945068"},{"type":"html","content":"<span class='clj-double'>191.4856567383</span>","value":"191.4856567383"}],"value":"[\"2024-01-29\" 192.0099945068 191.4856567383]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-30&quot;</span>","value":"\"2024-01-30\""},{"type":"html","content":"<span class='clj-double'>190.9400024414</span>","value":"190.9400024414"},{"type":"html","content":"<span class='clj-double'>187.8003540039</span>","value":"187.8003540039"}],"value":"[\"2024-01-30\" 190.9400024414 187.8003540039]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-01-31&quot;</span>","value":"\"2024-01-31\""},{"type":"html","content":"<span class='clj-double'>187.0399932861</span>","value":"187.0399932861"},{"type":"html","content":"<span class='clj-double'>184.1649932861</span>","value":"184.1649932861"}],"value":"[\"2024-01-31\" 187.0399932861 184.1649932861]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-01&quot;</span>","value":"\"2024-02-01\""},{"type":"html","content":"<span class='clj-double'>183.9900054932</span>","value":"183.9900054932"},{"type":"html","content":"<span class='clj-double'>186.6218719482</span>","value":"186.6218719482"}],"value":"[\"2024-02-01\" 183.9900054932 186.6218719482]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-02&quot;</span>","value":"\"2024-02-02\""},{"type":"html","content":"<span class='clj-double'>179.8600006104</span>","value":"179.8600006104"},{"type":"html","content":"<span class='clj-double'>185.6131591797</span>","value":"185.6131591797"}],"value":"[\"2024-02-02\" 179.8600006104 185.6131591797]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-05&quot;</span>","value":"\"2024-02-05\""},{"type":"html","content":"<span class='clj-double'>188.1499938965</span>","value":"188.1499938965"},{"type":"html","content":"<span class='clj-double'>187.4408111572</span>","value":"187.4408111572"}],"value":"[\"2024-02-05\" 188.1499938965 187.4408111572]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-06&quot;</span>","value":"\"2024-02-06\""},{"type":"html","content":"<span class='clj-double'>186.8600006104</span>","value":"186.8600006104"},{"type":"html","content":"<span class='clj-double'>189.0587615967</span>","value":"189.0587615967"}],"value":"[\"2024-02-06\" 186.8600006104 189.0587615967]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-07&quot;</span>","value":"\"2024-02-07\""},{"type":"html","content":"<span class='clj-double'>190.6399993896</span>","value":"190.6399993896"},{"type":"html","content":"<span class='clj-double'>189.1686248779</span>","value":"189.1686248779"}],"value":"[\"2024-02-07\" 190.6399993896 189.1686248779]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-08&quot;</span>","value":"\"2024-02-08\""},{"type":"html","content":"<span class='clj-double'>189.3899993896</span>","value":"189.3899993896"},{"type":"html","content":"<span class='clj-double'>188.0800170898</span>","value":"188.0800170898"}],"value":"[\"2024-02-08\" 189.3899993896 188.0800170898]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-09&quot;</span>","value":"\"2024-02-09\""},{"type":"html","content":"<span class='clj-double'>188.6499938965</span>","value":"188.6499938965"},{"type":"html","content":"<span class='clj-double'>188.8500061035</span>","value":"188.8500061035"}],"value":"[\"2024-02-09\" 188.6499938965 188.8500061035]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-12&quot;</span>","value":"\"2024-02-12\""},{"type":"html","content":"<span class='clj-double'>188.4199981689</span>","value":"188.4199981689"},{"type":"html","content":"<span class='clj-double'>187.1499938965</span>","value":"187.1499938965"}],"value":"[\"2024-02-12\" 188.4199981689 187.1499938965]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-13&quot;</span>","value":"\"2024-02-13\""},{"type":"html","content":"<span class='clj-double'>185.7700042725</span>","value":"185.7700042725"},{"type":"html","content":"<span class='clj-double'>185.0399932861</span>","value":"185.0399932861"}],"value":"[\"2024-02-13\" 185.7700042725 185.0399932861]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-14&quot;</span>","value":"\"2024-02-14\""},{"type":"html","content":"<span class='clj-double'>185.3200073242</span>","value":"185.3200073242"},{"type":"html","content":"<span class='clj-double'>184.1499938965</span>","value":"184.1499938965"}],"value":"[\"2024-02-14\" 185.3200073242 184.1499938965]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-15&quot;</span>","value":"\"2024-02-15\""},{"type":"html","content":"<span class='clj-double'>183.5500030518</span>","value":"183.5500030518"},{"type":"html","content":"<span class='clj-double'>183.8600006104</span>","value":"183.8600006104"}],"value":"[\"2024-02-15\" 183.5500030518 183.8600006104]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-16&quot;</span>","value":"\"2024-02-16\""},{"type":"html","content":"<span class='clj-double'>183.4199981689</span>","value":"183.4199981689"},{"type":"html","content":"<span class='clj-double'>182.3099975586</span>","value":"182.3099975586"}],"value":"[\"2024-02-16\" 183.4199981689 182.3099975586]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-20&quot;</span>","value":"\"2024-02-20\""},{"type":"html","content":"<span class='clj-double'>181.7899932861</span>","value":"181.7899932861"},{"type":"html","content":"<span class='clj-double'>181.5599975586</span>","value":"181.5599975586"}],"value":"[\"2024-02-20\" 181.7899932861 181.5599975586]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-21&quot;</span>","value":"\"2024-02-21\""},{"type":"html","content":"<span class='clj-double'>181.9400024414</span>","value":"181.9400024414"},{"type":"html","content":"<span class='clj-double'>182.3200073242</span>","value":"182.3200073242"}],"value":"[\"2024-02-21\" 181.9400024414 182.3200073242]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-22&quot;</span>","value":"\"2024-02-22\""},{"type":"html","content":"<span class='clj-double'>183.4799957275</span>","value":"183.4799957275"},{"type":"html","content":"<span class='clj-double'>184.3699951172</span>","value":"184.3699951172"}],"value":"[\"2024-02-22\" 183.4799957275 184.3699951172]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-23&quot;</span>","value":"\"2024-02-23\""},{"type":"html","content":"<span class='clj-double'>185.0099945068</span>","value":"185.0099945068"},{"type":"html","content":"<span class='clj-double'>182.5200042725</span>","value":"182.5200042725"}],"value":"[\"2024-02-23\" 185.0099945068 182.5200042725]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-26&quot;</span>","value":"\"2024-02-26\""},{"type":"html","content":"<span class='clj-double'>182.2400054932</span>","value":"182.2400054932"},{"type":"html","content":"<span class='clj-double'>181.1600036621</span>","value":"181.1600036621"}],"value":"[\"2024-02-26\" 182.2400054932 181.1600036621]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-27&quot;</span>","value":"\"2024-02-27\""},{"type":"html","content":"<span class='clj-double'>181.1000061035</span>","value":"181.1000061035"},{"type":"html","content":"<span class='clj-double'>182.6300048828</span>","value":"182.6300048828"}],"value":"[\"2024-02-27\" 181.1000061035 182.6300048828]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-28&quot;</span>","value":"\"2024-02-28\""},{"type":"html","content":"<span class='clj-double'>182.5099945068</span>","value":"182.5099945068"},{"type":"html","content":"<span class='clj-double'>181.4199981689</span>","value":"181.4199981689"}],"value":"[\"2024-02-28\" 182.5099945068 181.4199981689]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-02-29&quot;</span>","value":"\"2024-02-29\""},{"type":"html","content":"<span class='clj-double'>181.2700042725</span>","value":"181.2700042725"},{"type":"html","content":"<span class='clj-double'>180.75</span>","value":"180.75"}],"value":"[\"2024-02-29\" 181.2700042725 180.75]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-01&quot;</span>","value":"\"2024-03-01\""},{"type":"html","content":"<span class='clj-double'>179.5500030518</span>","value":"179.5500030518"},{"type":"html","content":"<span class='clj-double'>179.6600036621</span>","value":"179.6600036621"}],"value":"[\"2024-03-01\" 179.5500030518 179.6600036621]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-04&quot;</span>","value":"\"2024-03-04\""},{"type":"html","content":"<span class='clj-double'>176.1499938965</span>","value":"176.1499938965"},{"type":"html","content":"<span class='clj-double'>175.1000061035</span>","value":"175.1000061035"}],"value":"[\"2024-03-04\" 176.1499938965 175.1000061035]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-05&quot;</span>","value":"\"2024-03-05\""},{"type":"html","content":"<span class='clj-double'>170.7599945068</span>","value":"170.7599945068"},{"type":"html","content":"<span class='clj-double'>170.1199951172</span>","value":"170.1199951172"}],"value":"[\"2024-03-05\" 170.7599945068 170.1199951172]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-06&quot;</span>","value":"\"2024-03-06\""},{"type":"html","content":"<span class='clj-double'>171.0599975586</span>","value":"171.0599975586"},{"type":"html","content":"<span class='clj-double'>169.1199951172</span>","value":"169.1199951172"}],"value":"[\"2024-03-06\" 171.0599975586 169.1199951172]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-07&quot;</span>","value":"\"2024-03-07\""},{"type":"html","content":"<span class='clj-double'>169.1499938965</span>","value":"169.1499938965"},{"type":"html","content":"<span class='clj-double'>169.0</span>","value":"169.0"}],"value":"[\"2024-03-07\" 169.1499938965 169.0]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-08&quot;</span>","value":"\"2024-03-08\""},{"type":"html","content":"<span class='clj-double'>169.0</span>","value":"169.0"},{"type":"html","content":"<span class='clj-double'>170.7299957275</span>","value":"170.7299957275"}],"value":"[\"2024-03-08\" 169.0 170.7299957275]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-11&quot;</span>","value":"\"2024-03-11\""},{"type":"html","content":"<span class='clj-double'>172.9400024414</span>","value":"172.9400024414"},{"type":"html","content":"<span class='clj-double'>172.75</span>","value":"172.75"}],"value":"[\"2024-03-11\" 172.9400024414 172.75]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-12&quot;</span>","value":"\"2024-03-12\""},{"type":"html","content":"<span class='clj-double'>173.1499938965</span>","value":"173.1499938965"},{"type":"html","content":"<span class='clj-double'>173.2299957275</span>","value":"173.2299957275"}],"value":"[\"2024-03-12\" 173.1499938965 173.2299957275]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-13&quot;</span>","value":"\"2024-03-13\""},{"type":"html","content":"<span class='clj-double'>172.7700042725</span>","value":"172.7700042725"},{"type":"html","content":"<span class='clj-double'>171.1300048828</span>","value":"171.1300048828"}],"value":"[\"2024-03-13\" 172.7700042725 171.1300048828]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-14&quot;</span>","value":"\"2024-03-14\""},{"type":"html","content":"<span class='clj-double'>172.9100036621</span>","value":"172.9100036621"},{"type":"html","content":"<span class='clj-double'>173.0</span>","value":"173.0"}],"value":"[\"2024-03-14\" 172.9100036621 173.0]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-15&quot;</span>","value":"\"2024-03-15\""},{"type":"html","content":"<span class='clj-double'>171.1699981689</span>","value":"171.1699981689"},{"type":"html","content":"<span class='clj-double'>172.6199951172</span>","value":"172.6199951172"}],"value":"[\"2024-03-15\" 171.1699981689 172.6199951172]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-18&quot;</span>","value":"\"2024-03-18\""},{"type":"html","content":"<span class='clj-double'>175.5700073242</span>","value":"175.5700073242"},{"type":"html","content":"<span class='clj-double'>173.7200012207</span>","value":"173.7200012207"}],"value":"[\"2024-03-18\" 175.5700073242 173.7200012207]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-19&quot;</span>","value":"\"2024-03-19\""},{"type":"html","content":"<span class='clj-double'>174.3399963379</span>","value":"174.3399963379"},{"type":"html","content":"<span class='clj-double'>176.0800018311</span>","value":"176.0800018311"}],"value":"[\"2024-03-19\" 174.3399963379 176.0800018311]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-03-20&quot;</span>","value":"\"2024-03-20\""},{"type":"html","content":"<span class='clj-double'>175.7200012207</span>","value":"175.7200012207"},{"type":"html","content":"<span class='clj-double'>178.6699981689</span>","value":"178.6699981689"}],"value":"[\"2024-03-20\" 175.7200012207 178.6699981689]"}],"value":"[[\"2023-12-26\" 193.6100006104 192.8039855957] [\"2023-12-27\" 192.4900054932 192.9038391113] [\"2023-12-28\" 194.1399993896 193.3332977295] [\"2023-12-29\" 193.8999938965 192.2846374512] [\"2024-01-02\" 187.1499938965 185.4034118652] [\"2024-01-03\" 184.2200012207 184.0151977539] [\"2024-01-04\" 182.1499938965 181.6781768799] [\"2024-01-05\" 181.9900054932 180.9490966797] [\"2024-01-08\" 182.0899963379 185.3235168457] [\"2024-01-09\" 183.9199981689 184.9040527344] [\"2024-01-10\" 184.3500061035 185.9527130127] [\"2024-01-11\" 186.5399932861 185.3534851074] [\"2024-01-12\" 186.0599975586 185.6830596924] [\"2024-01-16\" 182.1600036621 183.395980835] [\"2024-01-17\" 181.2700042725 182.4471893311] [\"2024-01-18\" 186.0899963379 188.3896179199] [\"2024-01-19\" 189.3300018311 191.3158721924] [\"2024-01-22\" 192.3000030518 193.6428985596] [\"2024-01-23\" 195.0200042725 194.9312591553] [\"2024-01-24\" 195.4199981689 194.2521209717] [\"2024-01-25\" 195.2200012207 193.9225463867] [\"2024-01-26\" 194.2700042725 192.1747741699] [\"2024-01-29\" 192.0099945068 191.4856567383] [\"2024-01-30\" 190.9400024414 187.8003540039] [\"2024-01-31\" 187.0399932861 184.1649932861] [\"2024-02-01\" 183.9900054932 186.6218719482] [\"2024-02-02\" 179.8600006104 185.6131591797] [\"2024-02-05\" 188.1499938965 187.4408111572] [\"2024-02-06\" 186.8600006104 189.0587615967] [\"2024-02-07\" 190.6399993896 189.1686248779] [\"2024-02-08\" 189.3899993896 188.0800170898] [\"2024-02-09\" 188.6499938965 188.8500061035] [\"2024-02-12\" 188.4199981689 187.1499938965] [\"2024-02-13\" 185.7700042725 185.0399932861] [\"2024-02-14\" 185.3200073242 184.1499938965] [\"2024-02-15\" 183.5500030518 183.8600006104] [\"2024-02-16\" 183.4199981689 182.3099975586] [\"2024-02-20\" 181.7899932861 181.5599975586] [\"2024-02-21\" 181.9400024414 182.3200073242] [\"2024-02-22\" 183.4799957275 184.3699951172] [\"2024-02-23\" 185.0099945068 182.5200042725] [\"2024-02-26\" 182.2400054932 181.1600036621] [\"2024-02-27\" 181.1000061035 182.6300048828] [\"2024-02-28\" 182.5099945068 181.4199981689] [\"2024-02-29\" 181.2700042725 180.75] [\"2024-03-01\" 179.5500030518 179.6600036621] [\"2024-03-04\" 176.1499938965 175.1000061035] [\"2024-03-05\" 170.7599945068 170.1199951172] [\"2024-03-06\" 171.0599975586 169.1199951172] [\"2024-03-07\" 169.1499938965 169.0] [\"2024-03-08\" 169.0 170.7299957275] [\"2024-03-11\" 172.9400024414 172.75] [\"2024-03-12\" 173.1499938965 173.2299957275] [\"2024-03-13\" 172.7700042725 171.1300048828] [\"2024-03-14\" 172.9100036621 173.0] [\"2024-03-15\" 171.1699981689 172.6199951172] [\"2024-03-18\" 175.5700073242 173.7200012207] [\"2024-03-19\" 174.3399963379 176.0800018311] [\"2024-03-20\" 175.7200012207 178.6699981689]]"}
;; <=

;; **
;;; ### Portfolio Processing Section
;; **

;; @@
(defn calculate-portfolio-new [data]
  (loop [cash 0.0
         portfolio {}
         portfolio-value {}
         current-value 0.0
         stock-performance {}
         cash-invested {}
         cash-invested-by-date {}
         data (rest data)]
    (if (empty? data)
      [cash portfolio portfolio-value current-value cash-invested cash-invested-by-date stock-performance]
      (let [[date action amount ticker] (first data)
            ticker-prices (server/get-ticker-price-all ticker (parse-date date))
            executed-date (first (first ticker-prices))				; gets the date the buy/sell order is executed
            ]
        (cond
          (= action "buy")
          (if (pos? (Double. amount))
            (let [price (second (first ticker-prices))              ; Gets open price of next trading day
                  currPrice (nth (last ticker-prices) 2)
                  prices (mapv #(nth % 2) ticker-prices)                ; Extracts the prices from ticker-prices
                  amounts (repeatedly (count prices) #(Double. amount))	; Creates a sequence of amounts matching the number of prices
                  trading-dates (mapv #(first %) ticker-prices)
                  ]
              (recur (- cash (* (Double. amount) price))
                     (assoc portfolio ticker (+ (get portfolio ticker 0) (Double. amount)))
                     (merge-with + portfolio-value (zipmap (map first ticker-prices) (map #(- % (* (Double. amount) price))(map * prices amounts)))) ; Updates portfolio-value with the calculated values
                     (+ current-value (* (Double. amount) currPrice))
                     
                     (assoc stock-performance ticker (calculate-returns-with-corresponding-date prices trading-dates))
                     (assoc cash-invested ticker (+ (get cash-invested ticker 0) (* (Double. amount) price)))
                     (assoc cash-invested-by-date executed-date cash-invested)
                     (rest data)))
            (recur cash portfolio portfolio-value current-value cash-invested cash-invested-by-date stock-performance (rest data)))

          (= action "sell")
          (let [price (second (first ticker-prices))
                currPrice (second (last ticker-prices))
                prices (map second ticker-prices)
                amounts (repeatedly (count prices) #(Double. amount))]
            (recur (+ cash (* (Double. amount) price))
                   (assoc portfolio ticker (- (get portfolio ticker 0) (Double. amount)))
                   (merge-with + portfolio-value (zipmap (map first ticker-prices) (map #(- % (* (Double. amount) price))(map * prices amounts)))) ; Updates portfolio-value with the calculated values
                   (- current-value (* (Double. amount) currPrice))
                   
                   (assoc stock-performance ticker (calculate-returns prices))
                   (assoc cash-invested ticker (- (get cash-invested ticker 0) (* (Double. amount) price)))
                   (assoc cash-invested-by-date executed-date cash-invested)
                   (rest data)))
          )))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;cim_portfolio.portfolio/calculate-portfolio-new</span>","value":"#'cim_portfolio.portfolio/calculate-portfolio-new"}
;; <=

;; @@
(def portfolio-options {
                        :starting-cash 100000
                       }
)

(def view-options {
                   :show-individual-stock-performance-by-day 	false
                   :show-cumulative-portfolio-return-by-day		true
                   :show-portfolio-value-by-day					true
                  }
)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;cim_portfolio.portfolio/view-options</span>","value":"#'cim_portfolio.portfolio/view-options"}
;; <=

;; @@
(def input-file "testPortfolio.csv")

(let [data (read-csv input-file)
      [cash portfolio portfolio-value current-value cash-invested cash-invested-by-date stock-performance] (calculate-portfolio-new data)
      sorted-portfolio-value (map #(vector (first %) (+ (:starting-cash portfolio-options) (second %))) (sort-map-by-date portfolio-value))
      cash-invested-by-dates (into [] cash-invested-by-date)
      returns-by-date (zipmap (map #(first %) cash-invested-by-date)(mapv #(calculate-portfolio-return-for-given-date (second %) stock-performance (first %)) cash-invested-by-dates))
      ]
  
  (println "\n\n----------------------------------")
  (println "Current Portfolio Value:" (+ (:starting-cash portfolio-options) (+ cash current-value)) "\n")
  (println "Cash On Hand (excluding value of portfolio):" (+ (:starting-cash portfolio-options) cash) "\n")
  (println "Portfolio (units held per ticker):" portfolio "\n")
  (println "Value of assets in Portfolio: " cash-invested "\n")
  (println "Cumulative Portfolio Return: " (calculate-portfolio-return cash-invested stock-performance) "\n")
  
  (println "----------------------------------")
  (if (:show-cumulative-portfolio-return-by-day view-options) (println "Portfolio Return by date: \n" returns-by-date))
  (println "----------------------------------\n")
  
  (println "----------------------------------")
  (println "Cumulative Portfolio Value: ")
  (if (:show-portfolio-value-by-day view-options) 
    (run! println sorted-portfolio-value)
    (println "Omitting...")
  )
  (println "----------------------------------\n")
  
  (println "----------------------------------")
  (println "Individual Stock Performance: ")
  (if (:show-individual-stock-performance-by-day view-options) 
    (run! println stock-performance)
    (println "Omitting...")
  )
  (println "----------------------------------\n")
)
;; @@
;; ->
;;; [*********************100%%**********************]  1 of 1 completed
;;; [*********************100%%**********************]  1 of 1 completed
;;; [*********************100%%**********************]  1 of 1 completed
;;; [*********************100%%**********************]  1 of 1 completed
;;; [*********************100%%**********************]  1 of 1 completed
;;; [*********************100%%**********************]  1 of 1 completed
;;; [*********************100%%**********************]  1 of 1 completed
;;; [*********************100%%**********************]  1 of 1 completed
;;; 
;;; 
;;; ----------------------------------
;;; Current Portfolio Value: 114525.99666593899 
;;; 
;;; Cash On Hand (excluding value of portfolio): -27382.800636313506 
;;; 
;;; Portfolio (units held per ticker): {IEF 100.0, SHY 170.0, RSP 35.0, SPY 150.0, GSG 250.0, AGG 300.0} 
;;; 
;;; Value of assets in Portfolio:  {IEF 9070.99990845, SHY 13787.499618528002, RSP 4944.7999572755, SPY 65155.500793454994, GSG 5449.999809275, AGG 28974.00054933} 
;;; 
;;; Cumulative Portfolio Return:  0.1109539908547433 
;;; 
;;; ----------------------------------
;;; Portfolio Return by date: 
;;;  {2023-10-16 0.08377195284582868, 2023-11-06 0.1411782071766157, 2023-12-04 0.03526826633673455}
;;; ----------------------------------
;;; 
;;; ----------------------------------
;;; Cumulative Portfolio Value: 
;;; [2023-10-16 99751.1402893085]
;;; [2023-10-17 99682.1018981975]
;;; [2023-10-18 98985.3371429425]
;;; [2023-10-19 98508.374862664]
;;; [2023-10-20 97981.90681457351]
;;; [2023-10-23 97921.6446685765]
;;; [2023-10-24 98281.98417662749]
;;; [2023-10-25 97546.17301941101]
;;; [2023-10-26 97110.2529907155]
;;; [2023-10-27 96885.22262572951]
;;; [2023-10-30 97378.98933410851]
;;; [2023-10-31 97657.68089293249]
;;; [2023-11-01 98221.8370819095]
;;; [2023-11-02 99186.52107239251]
;;; [2023-11-03 99729.4824218765]
;;; [2023-11-06 99411.84524535]
;;; [2023-11-07 99495.12344360999]
;;; [2023-11-08 99498.0452728275]
;;; [2023-11-09 98813.6898612965]
;;; [2023-11-10 99941.801395393]
;;; [2023-11-13 99960.588169102]
;;; [2023-11-14 101550.9803390475]
;;; [2023-11-15 101582.141017886]
;;; [2023-11-16 101586.67119980151]
;;; [2023-11-17 101785.2397918715]
;;; [2023-11-20 102406.7042732175]
;;; [2023-11-21 102295.1596450735]
;;; [2023-11-22 102525.606174474]
;;; [2023-11-24 102472.173252102]
;;; [2023-11-27 102373.184967053]
;;; [2023-11-28 102578.59661102049]
;;; [2023-11-29 102678.92650603151]
;;; [2023-11-30 102837.5090408235]
;;; [2023-12-01 103396.67196273901]
;;; [2023-12-04 102737.036609605]
;;; [2023-12-05 102912.81169891851]
;;; [2023-12-06 102610.3909492195]
;;; [2023-12-07 103182.279472327]
;;; [2023-12-08 103307.512416814]
;;; [2023-12-11 103617.97018051]
;;; [2023-12-12 103947.110156992]
;;; [2023-12-13 105636.73374174049]
;;; [2023-12-14 106374.58322522501]
;;; [2023-12-15 106145.48738478801]
;;; [2023-12-18 106502.75890348501]
;;; [2023-12-19 107086.463165254]
;;; [2023-12-20 106132.42414472501]
;;; [2023-12-21 106883.1965636915]
;;; [2023-12-22 106980.952167482]
;;; [2023-12-26 107442.92528149049]
;;; [2023-12-27 107821.7201995545]
;;; [2023-12-28 107681.528739935]
;;; [2023-12-29 107349.9555778045]
;;; [2024-01-02 106708.135280598]
;;; [2024-01-03 106190.93593593799]
;;; [2024-01-04 105755.270709986]
;;; [2024-01-05 105794.662418355]
;;; [2024-01-08 106911.10679622249]
;;; [2024-01-09 106826.47884365449]
;;; [2024-01-10 107124.886322006]
;;; [2024-01-11 107385.649681077]
;;; [2024-01-12 107541.2380599465]
;;; [2024-01-16 106886.622123682]
;;; [2024-01-17 106315.6855773805]
;;; [2024-01-18 106982.7144813255]
;;; [2024-01-19 107904.268932321]
;;; [2024-01-22 108212.3340988025]
;;; [2024-01-23 108351.109390248]
;;; [2024-01-24 108347.70660399299]
;;; [2024-01-25 109067.4516868415]
;;; [2024-01-26 108964.67464446102]
;;; [2024-01-29 109704.72160337449]
;;; [2024-01-30 109755.2660369315]
;;; [2024-01-31 108661.274738281]
;;; [2024-02-01 109843.795661893]
;;; [2024-02-02 110098.782749163]
;;; [2024-02-05 109444.34000014399]
;;; [2024-02-06 109948.5874938825]
;;; [2024-02-07 110536.7428016565]
;;; [2024-02-08 110535.0298881085]
;;; [2024-02-09 110951.274299594]
;;; [2024-02-12 110982.6910781725]
;;; [2024-02-13 109432.88583751749]
;;; [2024-02-14 110281.240596774]
;;; [2024-02-15 111012.8008460755]
;;; [2024-02-16 110487.676811196]
;;; [2024-02-20 110087.49027248849]
;;; [2024-02-21 110059.6440887345]
;;; [2024-02-22 111694.58900448651]
;;; [2024-02-23 111844.5780563305]
;;; [2024-02-26 111504.1526794295]
;;; [2024-02-27 111652.0214271475]
;;; [2024-02-28 111628.3973502835]
;;; [2024-02-29 112004.32367320999]
;;; [2024-03-01 112938.94208907001]
;;; [2024-03-04 112740.5570220835]
;;; [2024-03-05 112135.99117276349]
;;; [2024-03-06 112664.11415099]
;;; [2024-03-07 113579.224014265]
;;; [2024-03-08 113113.83821486999]
;;; [2024-03-11 113028.4652518935]
;;; [2024-03-12 113730.7987785055]
;;; [2024-03-13 113613.16265105]
;;; [2024-03-14 113168.30034256601]
;;; [2024-03-15 112623.3967399345]
;;; [2024-03-18 113126.84743880051]
;;; [2024-03-19 113699.551753994]
;;; [2024-03-20 114525.996665939]
;;; ----------------------------------
;;; 
;;; ----------------------------------
;;; Individual Stock Performance: 
;;; Omitting...
;;; ----------------------------------
;;; 
;;; 
;; <-
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; 
;; **

;; @@

;; @@
