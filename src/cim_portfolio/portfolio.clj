;; gorilla-repl.fileformat = 1

;; **
;;; # CIM Portfolio
;; **

;; **
;;; ### Required packages
;; **

;; @@
(ns cim_portfolio.portfolio
  (:require [cim_portfolio.util :as util]
            [cim_portfolio.yfinanceclient :as client]
            [cim_portfolio.plot :as plot]
            [clojure.math :as math]
            ))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; ### Portfolio Analysis Helper Functions
;; **

;; @@
;; Computes arithmetic, log, and cumulative return for a given list of prices
(defn calculate-returns [prices]
  (let [price-changes (map #(double (/ (second %) (first %))) (partition 2 1 prices))
        arithmetic-returns (mapv #(- % 1.0) price-changes)
        log-returns (mapv #(Math/log %) price-changes)
        cumulative-log-return (reduce + log-returns)]
    {
     :cumulative-return cumulative-log-return
     :arithmetic-returns arithmetic-returns
     :log-returns log-returns
     }))

;; Variation of the above function - additionally associates the returns with their corresponding date
(defn calculate-returns-with-corresponding-date [prices dates]
  (let [price-changes (map #(double (/ (second %) (first %))) (partition 2 1 prices))
        arithmetic-returns (mapv #(- % 1.0) price-changes)
        log-returns (mapv #(Math/log %) price-changes)
        cumulative-log-return (reduce + log-returns)]
    {
     :cumulative-return cumulative-log-return
     :arithmetic-returns (util/sort-map-by-date (zipmap (rest dates) arithmetic-returns))
     :log-returns (util/sort-map-by-date (zipmap (rest dates) log-returns))
     }))

;; Calculates portfolio return - accepts map {:stock cash-invested} and stock-performance generated by calculate-returns
(defn calculate-portfolio-return [cash-invested returns]
  (let [total-investment (apply + (vals cash-invested))]
    (->> cash-invested
         (map (fn [[security invested]]
                (let [weight (/ invested total-investment)
                      return (:cumulative-return (get returns security))]
                  (* weight return))))
         (apply +))))

;; Calculates cumulative return UP TILL a given date
(defn get-cumulative-return-till-given-date [cumulative-returns date]
  (util/sum-up-to-key date cumulative-returns)
)

;; Only calculates portfolio return up till a given date
(defn calculate-portfolio-return-for-given-date [cash-invested returns date]
  (let [total-investment (apply + (vals cash-invested))]
    (->> cash-invested
         (map (fn [[security invested]]
                (let [weight (/ invested total-investment)
                      return (get-cumulative-return-till-given-date (:log-returns (get returns security)) date)
                     ]
                  (* weight return))))
         (apply +))))

; Calculates the annualized return of the portfolio (accepts the starting value, ending value of portfolio, the start and end date)
(defn calculate-annualized-return [starting-value ending-value start-date end-date]
  (let [return (/ (- ending-value starting-value) starting-value)
        number-of-days (util/number-of-days-between start-date end-date)
       ]
    (- (math/pow (+ 1 return) (/ 365 number-of-days)) 1)
  )
)

; Calculates the volatility of a given list of prices (expected input: portfolio value list)
(defn volatility [prices]
  (let [daily-returns (:arithmetic-returns (calculate-returns prices))
        volatility (* 100 (util/std-dev daily-returns))
       ]
    volatility
  )
)

; Calculates the volatility for a given sliding window-size
(defn rolling-volatility [prices window-size]
  (let [returns (:arithmetic-returns (calculate-returns prices))]
    (->> returns
         (partition window-size 1)
         (map util/std-dev)
      	 (map #(* 100 %))
    )
  )
)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;cim_portfolio.portfolio/rolling-volatility</span>","value":"#'cim_portfolio.portfolio/rolling-volatility"}
;; <=

;; @@
(def test-prices [100 105 110 103 108 115])

(println test-prices)

(:arithmetic-returns (calculate-returns test-prices)) ;; Daily returns (as percentage of change)

(rolling-volatility test-prices 3)
;; @@
;; ->
;;; [100 105 110 103 108 115]
;;; 
;; <-
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>6.493157758793351</span>","value":"6.493157758793351"},{"type":"html","content":"<span class='clj-double'>6.450191958030683</span>","value":"6.450191958030683"},{"type":"html","content":"<span class='clj-double'>6.993904375922838</span>","value":"6.993904375922838"}],"value":"(6.493157758793351 6.450191958030683 6.993904375922838)"}
;; <=

;; @@
(calculate-returns test-prices)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:cumulative-return</span>","value":":cumulative-return"},{"type":"html","content":"<span class='clj-double'>0.1397619423751591</span>","value":"0.1397619423751591"}],"value":"[:cumulative-return 0.1397619423751591]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:arithmetic-returns</span>","value":":arithmetic-returns"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.050000000000000044</span>","value":"0.050000000000000044"},{"type":"html","content":"<span class='clj-double'>0.047619047619047894</span>","value":"0.047619047619047894"},{"type":"html","content":"<span class='clj-double'>-0.0636363636363636</span>","value":"-0.0636363636363636"},{"type":"html","content":"<span class='clj-double'>0.048543689320388106</span>","value":"0.048543689320388106"},{"type":"html","content":"<span class='clj-double'>0.0648148148148151</span>","value":"0.0648148148148151"}],"value":"[0.050000000000000044 0.047619047619047894 -0.0636363636363636 0.048543689320388106 0.0648148148148151]"}],"value":"[:arithmetic-returns [0.050000000000000044 0.047619047619047894 -0.0636363636363636 0.048543689320388106 0.0648148148148151]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:log-returns</span>","value":":log-returns"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.04879016416943205</span>","value":"0.04879016416943205"},{"type":"html","content":"<span class='clj-double'>0.04652001563489312</span>","value":"0.04652001563489312"},{"type":"html","content":"<span class='clj-double'>-0.06575137756278042</span>","value":"-0.06575137756278042"},{"type":"html","content":"<span class='clj-double'>0.04740223889458369</span>","value":"0.04740223889458369"},{"type":"html","content":"<span class='clj-double'>0.06280090123903065</span>","value":"0.06280090123903065"}],"value":"[0.04879016416943205 0.04652001563489312 -0.06575137756278042 0.04740223889458369 0.06280090123903065]"}],"value":"[:log-returns [0.04879016416943205 0.04652001563489312 -0.06575137756278042 0.04740223889458369 0.06280090123903065]]"}],"value":"{:cumulative-return 0.1397619423751591, :arithmetic-returns [0.050000000000000044 0.047619047619047894 -0.0636363636363636 0.048543689320388106 0.0648148148148151], :log-returns [0.04879016416943205 0.04652001563489312 -0.06575137756278042 0.04740223889458369 0.06280090123903065]}"}
;; <=

;; @@
(calculate-annualized-return 2000 2500 "2023-10-16" "2024-04-27")
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-double'>0.5217057952294997</span>","value":"0.5217057952294997"}
;; <=

;; **
;;; ### YFinance API
;; **

;; @@
(client/get-ticker-price-all "NVDA" "2024-04-15")
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-16&quot;</span>","value":"\"2024-04-16\""},{"type":"html","content":"<span class='clj-double'>864.3300170898</span>","value":"864.3300170898"},{"type":"html","content":"<span class='clj-double'>874.1500244141</span>","value":"874.1500244141"}],"value":"[\"2024-04-16\" 864.3300170898 874.1500244141]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-17&quot;</span>","value":"\"2024-04-17\""},{"type":"html","content":"<span class='clj-double'>883.4000244141</span>","value":"883.4000244141"},{"type":"html","content":"<span class='clj-double'>840.3499755859</span>","value":"840.3499755859"}],"value":"[\"2024-04-17\" 883.4000244141 840.3499755859]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-18&quot;</span>","value":"\"2024-04-18\""},{"type":"html","content":"<span class='clj-double'>849.700012207</span>","value":"849.700012207"},{"type":"html","content":"<span class='clj-double'>846.7100219727</span>","value":"846.7100219727"}],"value":"[\"2024-04-18\" 849.700012207 846.7100219727]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-19&quot;</span>","value":"\"2024-04-19\""},{"type":"html","content":"<span class='clj-double'>831.5</span>","value":"831.5"},{"type":"html","content":"<span class='clj-double'>762.0</span>","value":"762.0"}],"value":"[\"2024-04-19\" 831.5 762.0]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-22&quot;</span>","value":"\"2024-04-22\""},{"type":"html","content":"<span class='clj-double'>781.0399780273</span>","value":"781.0399780273"},{"type":"html","content":"<span class='clj-double'>795.1799926758</span>","value":"795.1799926758"}],"value":"[\"2024-04-22\" 781.0399780273 795.1799926758]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-23&quot;</span>","value":"\"2024-04-23\""},{"type":"html","content":"<span class='clj-double'>807.6900024414</span>","value":"807.6900024414"},{"type":"html","content":"<span class='clj-double'>824.2299804688</span>","value":"824.2299804688"}],"value":"[\"2024-04-23\" 807.6900024414 824.2299804688]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-24&quot;</span>","value":"\"2024-04-24\""},{"type":"html","content":"<span class='clj-double'>839.5</span>","value":"839.5"},{"type":"html","content":"<span class='clj-double'>796.7700195312</span>","value":"796.7700195312"}],"value":"[\"2024-04-24\" 839.5 796.7700195312]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-25&quot;</span>","value":"\"2024-04-25\""},{"type":"html","content":"<span class='clj-double'>788.6799926758</span>","value":"788.6799926758"},{"type":"html","content":"<span class='clj-double'>826.3200073242</span>","value":"826.3200073242"}],"value":"[\"2024-04-25\" 788.6799926758 826.3200073242]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-26&quot;</span>","value":"\"2024-04-26\""},{"type":"html","content":"<span class='clj-double'>838.1799926758</span>","value":"838.1799926758"},{"type":"html","content":"<span class='clj-double'>877.3499755859</span>","value":"877.3499755859"}],"value":"[\"2024-04-26\" 838.1799926758 877.3499755859]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-29&quot;</span>","value":"\"2024-04-29\""},{"type":"html","content":"<span class='clj-double'>875.950012207</span>","value":"875.950012207"},{"type":"html","content":"<span class='clj-double'>877.5700073242</span>","value":"877.5700073242"}],"value":"[\"2024-04-29\" 875.950012207 877.5700073242]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-04-30&quot;</span>","value":"\"2024-04-30\""},{"type":"html","content":"<span class='clj-double'>872.4000244141</span>","value":"872.4000244141"},{"type":"html","content":"<span class='clj-double'>864.0200195312</span>","value":"864.0200195312"}],"value":"[\"2024-04-30\" 872.4000244141 864.0200195312]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-05-01&quot;</span>","value":"\"2024-05-01\""},{"type":"html","content":"<span class='clj-double'>850.7700195312</span>","value":"850.7700195312"},{"type":"html","content":"<span class='clj-double'>830.4099731445</span>","value":"830.4099731445"}],"value":"[\"2024-05-01\" 850.7700195312 830.4099731445]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-05-02&quot;</span>","value":"\"2024-05-02\""},{"type":"html","content":"<span class='clj-double'>844.4899902344</span>","value":"844.4899902344"},{"type":"html","content":"<span class='clj-double'>858.1699829102</span>","value":"858.1699829102"}],"value":"[\"2024-05-02\" 844.4899902344 858.1699829102]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;2024-05-03&quot;</span>","value":"\"2024-05-03\""},{"type":"html","content":"<span class='clj-double'>877.8900146484</span>","value":"877.8900146484"},{"type":"html","content":"<span class='clj-double'>887.8900146484</span>","value":"887.8900146484"}],"value":"[\"2024-05-03\" 877.8900146484 887.8900146484]"}],"value":"[[\"2024-04-16\" 864.3300170898 874.1500244141] [\"2024-04-17\" 883.4000244141 840.3499755859] [\"2024-04-18\" 849.700012207 846.7100219727] [\"2024-04-19\" 831.5 762.0] [\"2024-04-22\" 781.0399780273 795.1799926758] [\"2024-04-23\" 807.6900024414 824.2299804688] [\"2024-04-24\" 839.5 796.7700195312] [\"2024-04-25\" 788.6799926758 826.3200073242] [\"2024-04-26\" 838.1799926758 877.3499755859] [\"2024-04-29\" 875.950012207 877.5700073242] [\"2024-04-30\" 872.4000244141 864.0200195312] [\"2024-05-01\" 850.7700195312 830.4099731445] [\"2024-05-02\" 844.4899902344 858.1699829102] [\"2024-05-03\" 877.8900146484 887.8900146484]]"}
;; <=

;; **
;;; ### Portfolio Processing Section
;; **

;; @@
(defn analyze-portfolio [data]
  (loop [cash 0.0
         portfolio {}
         portfolio-value {}
         current-value 0.0
         stock-performance {}
         cash-invested {}
         cash-invested-by-date {}
         data (rest data)]
    (if (empty? data)
      [cash portfolio portfolio-value current-value cash-invested cash-invested-by-date stock-performance]
      (let [[date action amount ticker] (first data)
            ticker-prices (client/get-ticker-price-all ticker (util/parse-date date))
            executed-date (first (first ticker-prices))				; gets the date the buy/sell order is executed
            ]
        (cond
          (= action "buy")
          (if (pos? (Double. amount))
            (let [price (second (first ticker-prices))        	; Gets open price of next trading day
                  currPrice (nth (last ticker-prices) 2)		; Gets adj close price of latest day
                  prices (mapv #(nth % 2) ticker-prices)       	; Extracts the prices from ticker-prices
                  amounts (repeatedly (count prices) #(Double. amount))	; Creates a sequence of amounts matching the number of prices
                  trading-dates (mapv #(first %) ticker-prices)
                  ]
              (recur (- cash (* (Double. amount) price))
                     (assoc portfolio ticker (+ (get portfolio ticker 0) (Double. amount)))
                     (merge-with + portfolio-value (zipmap (map first ticker-prices) (map #(- % (* (Double. amount) price))(map * prices amounts)))) ; Updates portfolio-value with the calculated values
                     (+ current-value (* (Double. amount) currPrice))
                     
                     (assoc stock-performance ticker (calculate-returns-with-corresponding-date prices trading-dates))
                     (assoc cash-invested ticker (+ (get cash-invested ticker 0) (* (Double. amount) price)))
                     (assoc cash-invested-by-date executed-date (assoc cash-invested ticker (+ (get cash-invested ticker 0) (* (Double. amount) price))))
                     (rest data)))
            (recur cash portfolio portfolio-value current-value cash-invested cash-invested-by-date stock-performance (rest data)))

          (= action "sell")
          (let [price (second (first ticker-prices))
                currPrice (second (last ticker-prices))
                prices (map second ticker-prices)
                amounts (repeatedly (count prices) #(Double. amount))
                trading-dates (mapv #(first %) ticker-prices)
                ]
            (recur (+ cash (* (Double. amount) price))
                   (assoc portfolio ticker (- (get portfolio ticker 0) (Double. amount)))
                   (merge-with + portfolio-value (zipmap (map first ticker-prices) (map #(- % (* (Double. amount) price))(map * prices amounts)))) ; Updates portfolio-value with the calculated values
                   (- current-value (* (Double. amount) currPrice))
                   
                   (assoc stock-performance ticker (calculate-returns-with-corresponding-date prices trading-dates))
                   (assoc cash-invested ticker (- (get cash-invested ticker 0) (* (Double. amount) price)))
                   (assoc cash-invested-by-date executed-date (assoc cash-invested ticker (- (get cash-invested ticker 0) (* (Double. amount) price))))
                   (rest data)))
          )))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;cim_portfolio.portfolio/analyze-portfolio</span>","value":"#'cim_portfolio.portfolio/analyze-portfolio"}
;; <=

;; @@
(def portfolio-options {
                        :starting-cash 200000
                       }
)

(def view-options {
                   :show-individual-stock-performance-by-day 	false
                   :show-cumulative-portfolio-return-by-day		true
                   :show-portfolio-value-by-day					true
                  }
)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;cim_portfolio.portfolio/view-options</span>","value":"#'cim_portfolio.portfolio/view-options"}
;; <=

;; @@
;; Please enter the relative paths of 1 or more CSV files (in a list) containing your trades below:

(def input-files ["examples/testPortfolio1.csv" "examples/testPortfolio.csv"])

(let [data (util/read-multiple-csv input-files)
      [cash portfolio portfolio-value current-value cash-invested cash-invested-by-date stock-performance] (analyze-portfolio data)
      sorted-portfolio-value 	(map #(vector (first %) (+ (:starting-cash portfolio-options) (second %))) (util/sort-map-by-date portfolio-value))
      cash-invested-by-dates 	(into [] cash-invested-by-date)
      current-portfolio-value 	(+ (:starting-cash portfolio-options) (+ cash current-value))
      annualized-return 		(calculate-annualized-return (:starting-cash portfolio-options) current-portfolio-value (first (first sorted-portfolio-value)) (last (last sorted-portfolio-value)))
      cumulative-portfolio-return (calculate-portfolio-return cash-invested stock-performance)
      returns-by-date 			(zipmap (map #(first %) cash-invested-by-date)(mapv #(calculate-portfolio-return-for-given-date (second %) stock-performance (first %)) cash-invested-by-dates))
      volatility 				(volatility (map second sorted-portfolio-value))
      ]
  (def portfolio-value-by-day sorted-portfolio-value)
  
  (println "Current Portfolio Value: $" (format "%.2f" current-portfolio-value) "\n")
  
  (println "Annualized Return of portfolio:" (format "%.2f" (* annualized-return 100)) "%\n")
  (println "Volatility of portfolio:" (format "%.4f" volatility) "%\n")
  (println "Annualized volatility of portfolio:" (format "%.4f" (* (Math/sqrt 252) volatility)) "%\n")
  (println "Cash On Hand (excluding value of portfolio): $" (format "%.2f"(+ (:starting-cash portfolio-options) cash)) "\n")
  (println "Portfolio (units held of each stock):" portfolio "\n")
  (println "Cash invested in each stock: " cash-invested "\n")
  (println "Cumulative Portfolio Return: " cumulative-portfolio-return "\n")
  
  (println "----------------------------------")
  (if (:show-cumulative-portfolio-return-by-day view-options) (println "Portfolio Return by date: \n" returns-by-date))
  (println "----------------------------------\n")
  
  (println "----------------------------------")
  (println "Portfolio Value Day-by-Day: ")
  (if (:show-portfolio-value-by-day view-options) 
    (run! println (map #(vector (first %) (format "%.2f" (second %))) sorted-portfolio-value))
    (println "Omitting...")
  )
  (println "----------------------------------\n")
  
  (println "----------------------------------")
  (println "Individual Stock Performance: ")
  (if (:show-individual-stock-performance-by-day view-options) 
    (clojure.pprint/pprint stock-performance)
    (println "Omitting...")
  )
  (println "----------------------------------\n")
)
;; @@
;; ->
;;; Current Portfolio Value: $ 228508.15 
;;; 
;;; Annualized Return of portfolio: 27.38 %
;;; 
;;; Volatility of portfolio: 1.0891 %
;;; 
;;; Annualized volatility of portfolio: 17.2886 %
;;; 
;;; Cash On Hand (excluding value of portfolio): $ 23289.00 
;;; 
;;; Portfolio (units held of each stock): {IEF 100.0, NVDA 70.0, SHY 170.0, RSP 35.0, SPY 150.0, GOOG 50.0, TSLA -30.0, GSG 250.0, AGG 300.0} 
;;; 
;;; Cash invested in each stock:  {IEF 9070.99990845, NVDA 48171.300659181, SHY 13787.499618528002, RSP 4944.7999572755, SPY 65155.500793454994, GOOG 7172.49984741, TSLA -6015.600128175, GSG 5449.999809275, AGG 28974.00054933} 
;;; 
;;; Cumulative Portfolio Return:  0.08665562964104014 
;;; 
;;; ----------------------------------
;;; Portfolio Return by date: 
;;;  {2024-02-16 0.015612982522071935, 2024-02-26 0.031635471211146286, 2024-03-01 0.022653455418351273, 2024-03-11 0.03173349115893472, 2023-10-16 0.10244754928008598, 2023-11-06 0.09482235863890107, 2023-12-04 0.03668781110752333}
;;; ----------------------------------
;;; 
;;; ----------------------------------
;;; Portfolio Value Day-by-Day: 
;;; [2023-10-16 199688.21]
;;; [2023-10-17 199619.72]
;;; [2023-10-18 198923.19]
;;; [2023-10-19 198446.47]
;;; [2023-10-20 197919.69]
;;; [2023-10-23 197859.17]
;;; [2023-10-24 198219.42]
;;; [2023-10-25 197484.08]
;;; [2023-10-26 197047.75]
;;; [2023-10-27 196822.63]
;;; [2023-10-30 197316.58]
;;; [2023-10-31 197595.38]
;;; [2023-11-01 198158.91]
;;; [2023-11-02 199123.27]
;;; [2023-11-03 199665.80]
;;; [2023-11-06 199270.17]
;;; [2023-11-07 199353.08]
;;; [2023-11-08 199355.81]
;;; [2023-11-09 198672.11]
;;; [2023-11-10 199800.14]
;;; [2023-11-13 199818.93]
;;; [2023-11-14 201408.18]
;;; [2023-11-15 201439.92]
;;; [2023-11-16 201443.89]
;;; [2023-11-17 201642.49]
;;; [2023-11-20 202263.88]
;;; [2023-11-21 202152.20]
;;; [2023-11-22 202382.66]
;;; [2023-11-24 202329.56]
;;; [2023-11-27 202230.06]
;;; [2023-11-28 202435.07]
;;; [2023-11-29 202534.94]
;;; [2023-11-30 202693.84]
;;; [2023-12-01 203252.24]
;;; [2023-12-04 202418.92]
;;; [2023-12-05 202593.04]
;;; [2023-12-06 202289.97]
;;; [2023-12-07 202861.81]
;;; [2023-12-08 202988.49]
;;; [2023-12-11 203298.89]
;;; [2023-12-12 203627.39]
;;; [2023-12-13 205313.55]
;;; [2023-12-14 206049.34]
;;; [2023-12-15 205820.81]
;;; [2023-12-18 206178.58]
;;; [2023-12-19 206761.92]
;;; [2023-12-20 205806.84]
;;; [2023-12-21 206557.63]
;;; [2023-12-22 206655.64]
;;; [2023-12-26 207117.26]
;;; [2023-12-27 207494.36]
;;; [2023-12-28 207354.80]
;;; [2023-12-29 207023.67]
;;; [2024-01-02 206383.02]
;;; [2024-01-03 205865.57]
;;; [2024-01-04 205431.02]
;;; [2024-01-05 205471.06]
;;; [2024-01-08 206586.57]
;;; [2024-01-09 206501.98]
;;; [2024-01-10 206800.82]
;;; [2024-01-11 207060.06]
;;; [2024-01-12 207214.98]
;;; [2024-01-16 206562.30]
;;; [2024-01-17 205992.21]
;;; [2024-01-18 206659.48]
;;; [2024-01-19 207581.06]
;;; [2024-01-22 207888.59]
;;; [2024-01-23 208027.95]
;;; [2024-01-24 208025.15]
;;; [2024-01-25 208743.69]
;;; [2024-01-26 208641.27]
;;; [2024-01-29 209380.18]
;;; [2024-01-30 209430.37]
;;; [2024-01-31 208334.93]
;;; [2024-02-01 209515.94]
;;; [2024-02-02 209773.61]
;;; [2024-02-05 209121.36]
;;; [2024-02-06 209624.24]
;;; [2024-02-07 210212.89]
;;; [2024-02-08 210211.92]
;;; [2024-02-09 210628.36]
;;; [2024-02-12 210659.67]
;;; [2024-02-13 209112.40]
;;; [2024-02-14 209959.63]
;;; [2024-02-15 210690.54]
;;; [2024-02-16 208675.92]
;;; [2024-02-20 205114.57]
;;; [2024-02-21 203107.59]
;;; [2024-02-22 215807.88]
;;; [2024-02-23 216235.90]
;;; [2024-02-26 215935.99]
;;; [2024-02-27 215760.74]
;;; [2024-02-28 214565.03]
;;; [2024-02-29 216506.93]
;;; [2024-03-01 220522.65]
;;; [2024-03-04 223035.07]
;;; [2024-03-05 222668.74]
;;; [2024-03-06 225779.63]
;;; [2024-03-07 230627.95]
;;; [2024-03-08 225288.32]
;;; [2024-03-11 223400.29]
;;; [2024-03-12 230832.00]
;;; [2024-03-13 230507.56]
;;; [2024-03-14 226697.01]
;;; [2024-03-15 225004.37]
;;; [2024-03-18 227684.76]
;;; [2024-03-19 228135.59]
;;; [2024-03-20 230971.69]
;;; [2024-03-21 233147.57]
;;; [2024-03-22 235456.38]
;;; [2024-03-25 236771.59]
;;; [2024-03-26 235080.70]
;;; [2024-03-27 232943.41]
;;; [2024-03-28 232022.99]
;;; [2024-04-01 231835.49]
;;; [2024-04-02 229464.75]
;;; [2024-04-03 229164.02]
;;; [2024-04-04 225787.87]
;;; [2024-04-05 227527.92]
;;; [2024-04-08 227310.86]
;;; [2024-04-09 225593.80]
;;; [2024-04-10 224822.68]
;;; [2024-04-11 230149.94]
;;; [2024-04-12 227258.69]
;;; [2024-04-15 223453.52]
;;; [2024-04-16 223342.25]
;;; [2024-04-17 220246.39]
;;; [2024-04-18 219427.01]
;;; [2024-04-19 209711.87]
;;; [2024-04-22 212135.19]
;;; [2024-04-23 217076.97]
;;; [2024-04-24 215768.86]
;;; [2024-04-25 216544.65]
;;; [2024-04-26 225015.77]
;;; [2024-04-29 226888.42]
;;; [2024-04-30 223669.67]
;;; [2024-05-01 219347.25]
;;; [2024-05-02 223041.70]
;;; [2024-05-03 228213.55]
;;; ----------------------------------
;;; 
;;; ----------------------------------
;;; Individual Stock Performance: 
;;; Omitting...
;;; ----------------------------------
;;; 
;;; 
;; <-
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; ### Visualization
;;; 
;;; #### Portfolio Value
;; **

;; @@
(plot/list-plot (cons (:starting-cash portfolio-options) (map #(second %) portfolio-value-by-day)) :joined true :plot-size 800 :x-title "Day" :y-title "Portfolio Value (in $)" :color "#7f3b08")
;; @@
;; =>
;;; {"type":"vega","content":{"width":800,"height":494.4376,"padding":{"top":10,"left":80,"bottom":50,"right":10},"data":[{"name":"8943a448-29e9-4c62-bff2-e06b5b869f9c","values":[{"x":0,"y":200000},{"x":1,"y":199688.2124328545},{"x":2,"y":199619.7154998755},{"x":3,"y":198923.1928253125},{"x":4,"y":198446.470184328},{"x":5,"y":197919.6862792995},{"x":6,"y":197859.1693115165},{"x":7,"y":198219.42367552948},{"x":8,"y":197484.078292847},{"x":9,"y":197047.7475738435},{"x":10,"y":196822.6263427675},{"x":11,"y":197316.57539367452},{"x":12,"y":197595.3783416645},{"x":13,"y":198158.9114379915},{"x":14,"y":199123.2709503245},{"x":15,"y":199665.7967376725},{"x":16,"y":199270.167999246},{"x":17,"y":199353.080368037},{"x":18,"y":199355.8096313585},{"x":19,"y":198672.1141624455},{"x":20,"y":199800.139026615},{"x":21,"y":199818.934879307},{"x":22,"y":201408.1770706155},{"x":23,"y":201439.920864077},{"x":24,"y":201443.8932609505},{"x":25,"y":201642.4874114895},{"x":26,"y":202263.8758277695},{"x":27,"y":202152.2013473365},{"x":28,"y":202382.661991134},{"x":29,"y":202329.563007349},{"x":30,"y":202230.062789918},{"x":31,"y":202435.0701522755},{"x":32,"y":202534.9417495575},{"x":33,"y":202693.8441085735},{"x":34,"y":203252.236080166},{"x":35,"y":202418.9165687215},{"x":36,"y":202593.0369949345},{"x":37,"y":202289.9662208285},{"x":38,"y":202861.812858574},{"x":39,"y":202988.485927566},{"x":40,"y":203298.890743243},{"x":41,"y":203627.385120377},{"x":42,"y":205313.5458755465},{"x":43,"y":206049.339084605},{"x":44,"y":205820.809650386},{"x":45,"y":206178.57601162},{"x":46,"y":206761.921539295},{"x":47,"y":205806.839504197},{"x":48,"y":206557.62878416548},{"x":49,"y":206655.636768322},{"x":50,"y":207117.25954051848},{"x":51,"y":207494.36416623052},{"x":52,"y":207354.79724884502},{"x":53,"y":207023.6682700595},{"x":54,"y":206383.01679608802},{"x":55,"y":205865.567665076},{"x":56,"y":205431.022510514},{"x":57,"y":205471.055622057},{"x":58,"y":206586.5670776105},{"x":59,"y":206501.9777297735},{"x":60,"y":206800.816268925},{"x":61,"y":207060.060691816},{"x":62,"y":207214.9827956865},{"x":63,"y":206562.30449674098},{"x":64,"y":205992.2145843385},{"x":65,"y":206659.4835853185},{"x":66,"y":207581.0635948},{"x":67,"y":207888.5868453635},{"x":68,"y":208027.949218739},{"x":69,"y":208025.146942127},{"x":70,"y":208743.69070048048},{"x":71,"y":208641.26659392},{"x":72,"y":209380.1847076175},{"x":73,"y":209430.3683471545},{"x":74,"y":208334.929447167},{"x":75,"y":209515.942802394},{"x":76,"y":209773.609256716},{"x":77,"y":209121.356296526},{"x":78,"y":209624.2369842565},{"x":79,"y":210212.8885841435},{"x":80,"y":210211.9217490845},{"x":81,"y":210628.356132496},{"x":82,"y":210659.6698379375},{"x":83,"y":209112.3951911545},{"x":84,"y":209959.631786352},{"x":85,"y":210690.5358314375},{"x":86,"y":208675.91686248098},{"x":87,"y":205114.5672988805},{"x":88,"y":203107.5881195005},{"x":89,"y":215807.8790283145},{"x":90,"y":216235.90076447252},{"x":91,"y":215935.9934997565},{"x":92,"y":215760.7428932095},{"x":93,"y":214565.0339317345},{"x":94,"y":216506.933460226},{"x":95,"y":220522.648982979},{"x":96,"y":223035.0742339915},{"x":97,"y":222668.7407302755},{"x":98,"y":225779.630737285},{"x":99,"y":230627.954940774},{"x":100,"y":225288.320941904},{"x":101,"y":223400.29462813452},{"x":102,"y":230832.00010296752},{"x":103,"y":230507.559318532},{"x":104,"y":226697.00944902102},{"x":105,"y":225004.3721580345},{"x":106,"y":227684.7588157615},{"x":107,"y":228135.588588699},{"x":108,"y":230971.69452664402},{"x":109,"y":233147.569103225},{"x":110,"y":235456.3774871735},{"x":111,"y":236771.592254578},{"x":112,"y":235080.69974897453},{"x":113,"y":232943.407993299},{"x":114,"y":232022.9886436165},{"x":115,"y":231835.4895210175},{"x":116,"y":229464.752540585},{"x":117,"y":229164.023036936},{"x":118,"y":225787.872314449},{"x":119,"y":227527.9229736225},{"x":120,"y":227310.857391351},{"x":121,"y":225593.7995529085},{"x":122,"y":224822.680187205},{"x":123,"y":230149.94176862598},{"x":124,"y":227258.686161044},{"x":125,"y":223453.519954649},{"x":126,"y":223342.2546386415},{"x":127,"y":220246.3874816695},{"x":128,"y":219427.008171075},{"x":129,"y":209711.8675422585},{"x":130,"y":212135.18527981},{"x":131,"y":217076.97385787402},{"x":132,"y":215768.86190411448},{"x":133,"y":216544.645271288},{"x":134,"y":225015.7652854595},{"x":135,"y":226888.41545102152},{"x":136,"y":223669.6655273235},{"x":137,"y":219347.248172752},{"x":138,"y":223041.69681546552},{"x":139,"y":228213.55436323798}]}],"marks":[{"type":"line","from":{"data":"8943a448-29e9-4c62-bff2-e06b5b869f9c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#7f3b08"},"strokeWidth":{"value":3},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"8943a448-29e9-4c62-bff2-e06b5b869f9c","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"8943a448-29e9-4c62-bff2-e06b5b869f9c","field":"data.y"}}],"axes":[{"type":"x","scale":"x","title":"Day","titleOffset":40,"grid":true},{"type":"y","scale":"y","title":"Portfolio Value (in $)","titleOffset":65,"grid":true}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 800, :height 494.4376, :padding {:top 10, :left 80, :bottom 50, :right 10}, :data [{:name \"8943a448-29e9-4c62-bff2-e06b5b869f9c\", :values ({:x 0, :y 200000} {:x 1, :y 199688.2124328545} {:x 2, :y 199619.7154998755} {:x 3, :y 198923.1928253125} {:x 4, :y 198446.470184328} {:x 5, :y 197919.6862792995} {:x 6, :y 197859.1693115165} {:x 7, :y 198219.42367552948} {:x 8, :y 197484.078292847} {:x 9, :y 197047.7475738435} {:x 10, :y 196822.6263427675} {:x 11, :y 197316.57539367452} {:x 12, :y 197595.3783416645} {:x 13, :y 198158.9114379915} {:x 14, :y 199123.2709503245} {:x 15, :y 199665.7967376725} {:x 16, :y 199270.167999246} {:x 17, :y 199353.080368037} {:x 18, :y 199355.8096313585} {:x 19, :y 198672.1141624455} {:x 20, :y 199800.139026615} {:x 21, :y 199818.934879307} {:x 22, :y 201408.1770706155} {:x 23, :y 201439.920864077} {:x 24, :y 201443.8932609505} {:x 25, :y 201642.4874114895} {:x 26, :y 202263.8758277695} {:x 27, :y 202152.2013473365} {:x 28, :y 202382.661991134} {:x 29, :y 202329.563007349} {:x 30, :y 202230.062789918} {:x 31, :y 202435.0701522755} {:x 32, :y 202534.9417495575} {:x 33, :y 202693.8441085735} {:x 34, :y 203252.236080166} {:x 35, :y 202418.9165687215} {:x 36, :y 202593.0369949345} {:x 37, :y 202289.9662208285} {:x 38, :y 202861.812858574} {:x 39, :y 202988.485927566} {:x 40, :y 203298.890743243} {:x 41, :y 203627.385120377} {:x 42, :y 205313.5458755465} {:x 43, :y 206049.339084605} {:x 44, :y 205820.809650386} {:x 45, :y 206178.57601162} {:x 46, :y 206761.921539295} {:x 47, :y 205806.839504197} {:x 48, :y 206557.62878416548} {:x 49, :y 206655.636768322} {:x 50, :y 207117.25954051848} {:x 51, :y 207494.36416623052} {:x 52, :y 207354.79724884502} {:x 53, :y 207023.6682700595} {:x 54, :y 206383.01679608802} {:x 55, :y 205865.567665076} {:x 56, :y 205431.022510514} {:x 57, :y 205471.055622057} {:x 58, :y 206586.5670776105} {:x 59, :y 206501.9777297735} {:x 60, :y 206800.816268925} {:x 61, :y 207060.060691816} {:x 62, :y 207214.9827956865} {:x 63, :y 206562.30449674098} {:x 64, :y 205992.2145843385} {:x 65, :y 206659.4835853185} {:x 66, :y 207581.0635948} {:x 67, :y 207888.5868453635} {:x 68, :y 208027.949218739} {:x 69, :y 208025.146942127} {:x 70, :y 208743.69070048048} {:x 71, :y 208641.26659392} {:x 72, :y 209380.1847076175} {:x 73, :y 209430.3683471545} {:x 74, :y 208334.929447167} {:x 75, :y 209515.942802394} {:x 76, :y 209773.609256716} {:x 77, :y 209121.356296526} {:x 78, :y 209624.2369842565} {:x 79, :y 210212.8885841435} {:x 80, :y 210211.9217490845} {:x 81, :y 210628.356132496} {:x 82, :y 210659.6698379375} {:x 83, :y 209112.3951911545} {:x 84, :y 209959.631786352} {:x 85, :y 210690.5358314375} {:x 86, :y 208675.91686248098} {:x 87, :y 205114.5672988805} {:x 88, :y 203107.5881195005} {:x 89, :y 215807.8790283145} {:x 90, :y 216235.90076447252} {:x 91, :y 215935.9934997565} {:x 92, :y 215760.7428932095} {:x 93, :y 214565.0339317345} {:x 94, :y 216506.933460226} {:x 95, :y 220522.648982979} {:x 96, :y 223035.0742339915} {:x 97, :y 222668.7407302755} {:x 98, :y 225779.630737285} {:x 99, :y 230627.954940774} {:x 100, :y 225288.320941904} {:x 101, :y 223400.29462813452} {:x 102, :y 230832.00010296752} {:x 103, :y 230507.559318532} {:x 104, :y 226697.00944902102} {:x 105, :y 225004.3721580345} {:x 106, :y 227684.7588157615} {:x 107, :y 228135.588588699} {:x 108, :y 230971.69452664402} {:x 109, :y 233147.569103225} {:x 110, :y 235456.3774871735} {:x 111, :y 236771.592254578} {:x 112, :y 235080.69974897453} {:x 113, :y 232943.407993299} {:x 114, :y 232022.9886436165} {:x 115, :y 231835.4895210175} {:x 116, :y 229464.752540585} {:x 117, :y 229164.023036936} {:x 118, :y 225787.872314449} {:x 119, :y 227527.9229736225} {:x 120, :y 227310.857391351} {:x 121, :y 225593.7995529085} {:x 122, :y 224822.680187205} {:x 123, :y 230149.94176862598} {:x 124, :y 227258.686161044} {:x 125, :y 223453.519954649} {:x 126, :y 223342.2546386415} {:x 127, :y 220246.3874816695} {:x 128, :y 219427.008171075} {:x 129, :y 209711.8675422585} {:x 130, :y 212135.18527981} {:x 131, :y 217076.97385787402} {:x 132, :y 215768.86190411448} {:x 133, :y 216544.645271288} {:x 134, :y 225015.7652854595} {:x 135, :y 226888.41545102152} {:x 136, :y 223669.6655273235} {:x 137, :y 219347.248172752} {:x 138, :y 223041.69681546552} {:x 139, :y 228213.55436323798})}], :marks [{:type \"line\", :from {:data \"8943a448-29e9-4c62-bff2-e06b5b869f9c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#7f3b08\"}, :strokeWidth {:value 3}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"8943a448-29e9-4c62-bff2-e06b5b869f9c\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"8943a448-29e9-4c62-bff2-e06b5b869f9c\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\", :title \"Day\", :titleOffset 40, :grid true} {:type \"y\", :scale \"y\", :title \"Portfolio Value (in $)\", :titleOffset 65, :grid true}]}}"}
;; <=

;; **
;;; #### 30 Day Rolling Volatility
;; **

;; @@
(plot/list-plot (rolling-volatility (map second portfolio-value-by-day) 21) :joined true :plot-size 800 :x-title "Time" :y-title "Portfolio Volatility" :color "red") ;; 21 trading days in a month therefore 21 window-size used
;; @@
;; =>
;;; {"type":"vega","content":{"width":800,"height":494.4376,"padding":{"top":10,"left":80,"bottom":50,"right":10},"data":[{"name":"15887577-ea6e-4971-b055-5a008c5bca55","values":[{"x":0,"y":0.3191804952888005},{"x":1,"y":0.31877403965250606},{"x":2,"y":0.30610864110859654},{"x":3,"y":0.2983296757598404},{"x":4,"y":0.2916369259104259},{"x":5,"y":0.2922535899163076},{"x":6,"y":0.2917058661413249},{"x":7,"y":0.27301062332264814},{"x":8,"y":0.2648673968541867},{"x":9,"y":0.2592893156756043},{"x":10,"y":0.25848506438429075},{"x":11,"y":0.25864694233794083},{"x":12,"y":0.2583485579747139},{"x":13,"y":0.26881879861755187},{"x":14,"y":0.2651479368488596},{"x":15,"y":0.2628982011863743},{"x":16,"y":0.266741303895338},{"x":17,"y":0.2661338132648038},{"x":18,"y":0.2474825083153881},{"x":19,"y":0.22474121814445033},{"x":20,"y":0.27526896195654205},{"x":21,"y":0.23616838416374367},{"x":22,"y":0.24024620446942208},{"x":23,"y":0.23956671090270576},{"x":24,"y":0.24245068655130855},{"x":25,"y":0.2692801268431783},{"x":26,"y":0.2740517687910939},{"x":27,"y":0.27430372756309285},{"x":28,"y":0.2739726015200254},{"x":29,"y":0.2718183155307525},{"x":30,"y":0.27495582694942455},{"x":31,"y":0.2811565877566907},{"x":32,"y":0.29535928501085273},{"x":33,"y":0.30078187270333206},{"x":34,"y":0.2880617666303129},{"x":35,"y":0.28825131921212244},{"x":36,"y":0.3014710770923214},{"x":37,"y":0.29996381572243963},{"x":38,"y":0.30018953950542904},{"x":39,"y":0.2999566257601403},{"x":40,"y":0.29948612080429654},{"x":41,"y":0.25848848224388066},{"x":42,"y":0.2551415210055419},{"x":43,"y":0.26329144727036186},{"x":44,"y":0.2775654069287305},{"x":45,"y":0.2730096422091093},{"x":46,"y":0.24907094692465387},{"x":47,"y":0.2386337546771948},{"x":48,"y":0.24814279822095595},{"x":49,"y":0.24563424803057166},{"x":50,"y":0.25352260646426733},{"x":51,"y":0.25231027772600345},{"x":52,"y":0.2783616903193388},{"x":53,"y":0.290290770503141},{"x":54,"y":0.2808065580418877},{"x":55,"y":0.28693734427117584},{"x":56,"y":0.28845469040804506},{"x":57,"y":0.2734176129449074},{"x":58,"y":0.2726397030173513},{"x":59,"y":0.27347023057551323},{"x":60,"y":0.2737726806580976},{"x":61,"y":0.3267409074173928},{"x":62,"y":0.3249753198952544},{"x":63,"y":0.31945395626648443},{"x":64,"y":0.3904297290603641},{"x":65,"y":0.53591331568085},{"x":66,"y":0.569822596974731},{"x":67,"y":1.5019625474963236},{"x":68,"y":1.5013531681740002},{"x":69,"y":1.502642672459757},{"x":70,"y":1.5028948730539262},{"x":71,"y":1.5103920100143189},{"x":72,"y":1.519594147000762},{"x":73,"y":1.5536549166721412},{"x":74,"y":1.5638860793750522},{"x":75,"y":1.5668522633436286},{"x":76,"y":1.5780717488291893},{"x":77,"y":1.6240071555314448},{"x":78,"y":1.7340472718163187},{"x":79,"y":1.7519155871975718},{"x":80,"y":1.871366684664342},{"x":81,"y":1.873494019211613},{"x":82,"y":1.9127494066560617},{"x":83,"y":1.9291074018763998},{"x":84,"y":1.9378760425918098},{"x":85,"y":1.9140792611474566},{"x":86,"y":1.855822400309037},{"x":87,"y":1.8220390741370238},{"x":88,"y":1.3049457829720863},{"x":89,"y":1.304200260368189},{"x":90,"y":1.3229011205028796},{"x":91,"y":1.3504386444688252},{"x":92,"y":1.3454079979038966},{"x":93,"y":1.3434349332818925},{"x":94,"y":1.3272990802767348},{"x":95,"y":1.31109402019287},{"x":96,"y":1.3564794333287773},{"x":97,"y":1.3326295528630758},{"x":98,"y":1.2425567830467488},{"x":99,"y":1.1438000447441758},{"x":100,"y":1.130394145530209},{"x":101,"y":1.0032410577011355},{"x":102,"y":1.0394278909622534},{"x":103,"y":1.0410639993424613},{"x":104,"y":1.0292372163313335},{"x":105,"y":1.0299646730386756},{"x":106,"y":1.0277606020765182},{"x":107,"y":1.3343313524316769},{"x":108,"y":1.3462295078561493},{"x":109,"y":1.4454410111352223},{"x":110,"y":1.430019981879436},{"x":111,"y":1.4385787742280074},{"x":112,"y":1.7092113366391344},{"x":113,"y":1.7213810384199884},{"x":114,"y":1.7455182206675228},{"x":115,"y":1.779073643707591},{"x":116,"y":1.8260451461255784},{"x":117,"y":1.8717260636798496}]}],"marks":[{"type":"line","from":{"data":"15887577-ea6e-4971-b055-5a008c5bca55"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"red"},"strokeWidth":{"value":3},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"15887577-ea6e-4971-b055-5a008c5bca55","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"15887577-ea6e-4971-b055-5a008c5bca55","field":"data.y"}}],"axes":[{"type":"x","scale":"x","title":"Time","titleOffset":40,"grid":true},{"type":"y","scale":"y","title":"Portfolio Volatility","titleOffset":65,"grid":true}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 800, :height 494.4376, :padding {:top 10, :left 80, :bottom 50, :right 10}, :data [{:name \"15887577-ea6e-4971-b055-5a008c5bca55\", :values ({:x 0, :y 0.3191804952888005} {:x 1, :y 0.31877403965250606} {:x 2, :y 0.30610864110859654} {:x 3, :y 0.2983296757598404} {:x 4, :y 0.2916369259104259} {:x 5, :y 0.2922535899163076} {:x 6, :y 0.2917058661413249} {:x 7, :y 0.27301062332264814} {:x 8, :y 0.2648673968541867} {:x 9, :y 0.2592893156756043} {:x 10, :y 0.25848506438429075} {:x 11, :y 0.25864694233794083} {:x 12, :y 0.2583485579747139} {:x 13, :y 0.26881879861755187} {:x 14, :y 0.2651479368488596} {:x 15, :y 0.2628982011863743} {:x 16, :y 0.266741303895338} {:x 17, :y 0.2661338132648038} {:x 18, :y 0.2474825083153881} {:x 19, :y 0.22474121814445033} {:x 20, :y 0.27526896195654205} {:x 21, :y 0.23616838416374367} {:x 22, :y 0.24024620446942208} {:x 23, :y 0.23956671090270576} {:x 24, :y 0.24245068655130855} {:x 25, :y 0.2692801268431783} {:x 26, :y 0.2740517687910939} {:x 27, :y 0.27430372756309285} {:x 28, :y 0.2739726015200254} {:x 29, :y 0.2718183155307525} {:x 30, :y 0.27495582694942455} {:x 31, :y 0.2811565877566907} {:x 32, :y 0.29535928501085273} {:x 33, :y 0.30078187270333206} {:x 34, :y 0.2880617666303129} {:x 35, :y 0.28825131921212244} {:x 36, :y 0.3014710770923214} {:x 37, :y 0.29996381572243963} {:x 38, :y 0.30018953950542904} {:x 39, :y 0.2999566257601403} {:x 40, :y 0.29948612080429654} {:x 41, :y 0.25848848224388066} {:x 42, :y 0.2551415210055419} {:x 43, :y 0.26329144727036186} {:x 44, :y 0.2775654069287305} {:x 45, :y 0.2730096422091093} {:x 46, :y 0.24907094692465387} {:x 47, :y 0.2386337546771948} {:x 48, :y 0.24814279822095595} {:x 49, :y 0.24563424803057166} {:x 50, :y 0.25352260646426733} {:x 51, :y 0.25231027772600345} {:x 52, :y 0.2783616903193388} {:x 53, :y 0.290290770503141} {:x 54, :y 0.2808065580418877} {:x 55, :y 0.28693734427117584} {:x 56, :y 0.28845469040804506} {:x 57, :y 0.2734176129449074} {:x 58, :y 0.2726397030173513} {:x 59, :y 0.27347023057551323} {:x 60, :y 0.2737726806580976} {:x 61, :y 0.3267409074173928} {:x 62, :y 0.3249753198952544} {:x 63, :y 0.31945395626648443} {:x 64, :y 0.3904297290603641} {:x 65, :y 0.53591331568085} {:x 66, :y 0.569822596974731} {:x 67, :y 1.5019625474963236} {:x 68, :y 1.5013531681740002} {:x 69, :y 1.502642672459757} {:x 70, :y 1.5028948730539262} {:x 71, :y 1.5103920100143189} {:x 72, :y 1.519594147000762} {:x 73, :y 1.5536549166721412} {:x 74, :y 1.5638860793750522} {:x 75, :y 1.5668522633436286} {:x 76, :y 1.5780717488291893} {:x 77, :y 1.6240071555314448} {:x 78, :y 1.7340472718163187} {:x 79, :y 1.7519155871975718} {:x 80, :y 1.871366684664342} {:x 81, :y 1.873494019211613} {:x 82, :y 1.9127494066560617} {:x 83, :y 1.9291074018763998} {:x 84, :y 1.9378760425918098} {:x 85, :y 1.9140792611474566} {:x 86, :y 1.855822400309037} {:x 87, :y 1.8220390741370238} {:x 88, :y 1.3049457829720863} {:x 89, :y 1.304200260368189} {:x 90, :y 1.3229011205028796} {:x 91, :y 1.3504386444688252} {:x 92, :y 1.3454079979038966} {:x 93, :y 1.3434349332818925} {:x 94, :y 1.3272990802767348} {:x 95, :y 1.31109402019287} {:x 96, :y 1.3564794333287773} {:x 97, :y 1.3326295528630758} {:x 98, :y 1.2425567830467488} {:x 99, :y 1.1438000447441758} {:x 100, :y 1.130394145530209} {:x 101, :y 1.0032410577011355} {:x 102, :y 1.0394278909622534} {:x 103, :y 1.0410639993424613} {:x 104, :y 1.0292372163313335} {:x 105, :y 1.0299646730386756} {:x 106, :y 1.0277606020765182} {:x 107, :y 1.3343313524316769} {:x 108, :y 1.3462295078561493} {:x 109, :y 1.4454410111352223} {:x 110, :y 1.430019981879436} {:x 111, :y 1.4385787742280074} {:x 112, :y 1.7092113366391344} {:x 113, :y 1.7213810384199884} {:x 114, :y 1.7455182206675228} {:x 115, :y 1.779073643707591} {:x 116, :y 1.8260451461255784} {:x 117, :y 1.8717260636798496})}], :marks [{:type \"line\", :from {:data \"15887577-ea6e-4971-b055-5a008c5bca55\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"red\"}, :strokeWidth {:value 3}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"15887577-ea6e-4971-b055-5a008c5bca55\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"15887577-ea6e-4971-b055-5a008c5bca55\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\", :title \"Time\", :titleOffset 40, :grid true} {:type \"y\", :scale \"y\", :title \"Portfolio Volatility\", :titleOffset 65, :grid true}]}}"}
;; <=
